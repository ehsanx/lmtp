<!-- Generated by pkgdown: do not edit by hand -->
<!DOCTYPE html>
<html lang="en">
  <head>
  <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<title>LMTP Substitution Estimator — lmtp_sub • lmtp</title>


<!-- jquery -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
<!-- Bootstrap -->

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous" />

<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script>

<!-- bootstrap-toc -->
<link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script>

<!-- Font Awesome icons -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous" />
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous" />

<!-- clipboard.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script>

<!-- headroom.js -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script>

<!-- pkgdown -->
<link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script>




<meta property="og:title" content="LMTP Substitution Estimator — lmtp_sub" />
<meta property="og:description" content="G-computation estimator for the effects of traditional causal effects and
modified treatment policies for both point treatment and longitudinal data with binary,
continuous, or time-to-event outcomes. Supports binary, categorical, and continuous exposures." />




<!-- mathjax -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script>

<!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->



  </head>

  <body data-spy="scroll" data-target="#toc">
    <div class="container template-reference-topic">
      <header>
      <div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lmtp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.5</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
        <li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
    <li>
      <a href="../articles/articles/intro-lmtp.html">Getting Started with LMTP</a>
    </li>
  </ul>
</li>
      </ul>
      <ul class="nav navbar-nav navbar-right">
        
      </ul>
      
    </div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header>

<div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>LMTP Substitution Estimator</h1>
    
    <div class="hidden name"><code>lmtp_sub.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>G-computation estimator for the effects of traditional causal effects and
modified treatment policies for both point treatment and longitudinal data with binary,
continuous, or time-to-event outcomes. Supports binary, categorical, and continuous exposures.</p>
    </div>

    <pre class="usage"><span class='fu'>lmtp_sub</span>(
  <span class='kw'>data</span>,
  <span class='kw'>trt</span>,
  <span class='kw'>outcome</span>,
  baseline = <span class='kw'>NULL</span>,
  time_vary = <span class='kw'>NULL</span>,
  cens = <span class='kw'>NULL</span>,
  <span class='kw'>shift</span>,
  k = <span class='fl'>Inf</span>,
  outcome_type = <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"binomial"</span>, <span class='st'>"continuous"</span>),
  id = <span class='kw'>NULL</span>,
  bounds = <span class='kw'>NULL</span>,
  learners = <span class='kw'>NULL</span>,
  folds = <span class='fl'>10</span>,
  bound = <span class='fl'>1e-05</span>
)</pre>

    <h2 class="hasAnchor" id="arguments"><a class="anchor" href="#arguments"></a>Arguments</h2>
    <table class="ref-arguments">
    <colgroup><col class="name" /><col class="desc" /></colgroup>
    <tr>
      <th>data</th>
      <td><p>A data frame in wide format containing all necessary variables
for the estimation problem.</p></td>
    </tr>
    <tr>
      <th>trt</th>
      <td><p>A vector containing the column names of treatment variables ordered by time.</p></td>
    </tr>
    <tr>
      <th>outcome</th>
      <td><p>The column name of the outcome variable. In the case of time-to-event
analysis, a vector containing the columns names of intermediate outcome variables and the final
outcome variable ordered by time. Only numeric values are allowed. If the outcome type
is binary, data should be coded as 0 and 1.</p></td>
    </tr>
    <tr>
      <th>baseline</th>
      <td><p>An optional vector of columns names of baseline covariates to be
included for adjustment at every timepoint.</p></td>
    </tr>
    <tr>
      <th>time_vary</th>
      <td><p>A list the same length as the number of time points of observation with
the column names for new time-varying covariates introduced at each time point. The list
should be ordered following the time ordering of the model.</p></td>
    </tr>
    <tr>
      <th>cens</th>
      <td><p>An optional vector of column names of censoring indicators the same
length as the number of time points of observation. If missingness in the outcome is
present or if time-to-event outcome, must be provided.</p></td>
    </tr>
    <tr>
      <th>shift</th>
      <td><p>A two argument function that specifies how treatment variables should be shifted.
See examples for how to specify shift functions for continuous, binary, and categorical exposures.</p></td>
    </tr>
    <tr>
      <th>k</th>
      <td><p>An integer specifying how previous time points should be
used for estimation at the given time point. Default is <code>Inf</code>,
all time points.</p></td>
    </tr>
    <tr>
      <th>outcome_type</th>
      <td><p>Outcome variable type (i.e., continuous, binomial).</p></td>
    </tr>
    <tr>
      <th>id</th>
      <td><p>An optional column name containing cluster level identifiers.</p></td>
    </tr>
    <tr>
      <th>bounds</th>
      <td><p>An optional vector of the bounds for continuous outcomes. If <code>NULL</code>,
the bounds will be taken as the minimum and maximum of the observed data.
Should be left as <code>NULL</code> if the outcome type is binary.</p></td>
    </tr>
    <tr>
      <th>learners</th>
      <td><p>An optional <code>sl3</code> learner stack for estimation of the outcome
regression. If not specified, will default to using a generalized linear model.</p></td>
    </tr>
    <tr>
      <th>folds</th>
      <td><p>The number of folds to be used for cross-fitting. Minimum allowable number
is two folds.</p></td>
    </tr>
    <tr>
      <th>bound</th>
      <td><p>Determines that maximum and minimum values (scaled) predictions
will be bounded by. The default is 1e-5, bounding predictions by 1e-5 and 0.9999.</p></td>
    </tr>
    </table>

    <h2 class="hasAnchor" id="value"><a class="anchor" href="#value"></a>Value</h2>

    <p>A list of class <code>lmtp</code> containing the following components:</p>
<dt>estimator</dt><dd><p>The estimator used, in this case "substitution".</p></dd>
<dt>theta</dt><dd><p>The estimated population LMTP effect.</p></dd>
<dt>standard_error</dt><dd><p>NA</p></dd>
<dt>low</dt><dd><p>NA</p></dd>
<dt>high</dt><dd><p>NA</p></dd>
<dt>shift</dt><dd><p>The shift function specifying the treatment policy of interest.</p></dd>
<dt>outcome_reg</dt><dd><p>An n x Tau + 1 matrix of outcome regression predictions.
The mean of the first column is used for calculating theta.</p></dd>
<dt>weights_m</dt><dd><p>A list the same length as <code>folds</code>, containing the Super Learner
ensemble weights at each time-point for each fold for the outcome regression.</p></dd>
<dt>outcome_type</dt><dd><p>The outcome variable type.</p></dd>


    <h2 class="hasAnchor" id="examples"><a class="anchor" href="#examples"></a>Examples</h2>
    <pre class="examples"><div class='input'><span class='co'># \donttest{</span>
<span class='fu'><a href='https://rdrr.io/r/base/library.html'>library</a></span>(<span class='kw'>lmtp</span>)

<span class='co'># Example 1.1</span>
<span class='co'># Point treatment, continuous exposure, continuous outcome, no loss-to-follow-up</span>
<span class='co'># Interested in the effect of a population wide decrease in A of 5 units</span>
<span class='co'># The true value under this intervention is about 519.</span>
<span class='fu'><a href='https://rdrr.io/r/base/Random.html'>set.seed</a></span>(<span class='fl'>56</span>)
<span class='kw'>n</span> <span class='op'>&lt;-</span> <span class='fl'>1000</span>
<span class='kw'>W</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='kw'>n</span>, <span class='fl'>10</span>, <span class='fl'>5</span>)
<span class='kw'>A</span> <span class='op'>&lt;-</span> <span class='fl'>23</span> <span class='op'>+</span> <span class='fl'>5</span><span class='op'>*</span><span class='kw'>W</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='kw'>n</span>)
<span class='kw'>Y</span> <span class='op'>&lt;-</span> <span class='fl'>7.2</span><span class='op'>*</span><span class='kw'>A</span> <span class='op'>+</span> <span class='fl'>3</span><span class='op'>*</span><span class='kw'>W</span> <span class='op'>+</span> <span class='fu'><a href='https://rdrr.io/r/stats/Normal.html'>rnorm</a></span>(<span class='kw'>n</span>)
<span class='kw'>ex1_dat</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/data.frame.html'>data.frame</a></span>(<span class='kw'>W</span>, <span class='kw'>A</span>, <span class='kw'>Y</span>)
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>x</span>) <span class='kw'>data</span>[[<span class='kw'>x</span>]] <span class='op'>-</span> <span class='fl'>5</span>
<span class='kw'>psi1.1</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>ex1_dat</span>, <span class='st'>"A"</span>, <span class='st'>"Y"</span>, <span class='st'>"W"</span>, shift = <span class='kw'>d</span>,
                   outcome_type = <span class='st'>"continuous"</span>, folds = <span class='fl'>2</span>)
<span class='kw'>psi1.1</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 514.4555</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 1.2</span>
<span class='co'># Point treatment, continuous exposure, continuous outcome, no loss-to-follow-up</span>
<span class='co'># Interested in the effect of a modified treatment policy where A is decreased by 15</span>
<span class='co'># units only among observations whose observed A was above 80.</span>
<span class='co'># The true value under this intervention is about 513.</span>
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>x</span>) (<span class='kw'>data</span>[[<span class='kw'>x</span>]] <span class='op'>&gt;</span> <span class='fl'>80</span>)<span class='op'>*</span>(<span class='kw'>data</span>[[<span class='kw'>x</span>]] <span class='op'>-</span> <span class='fl'>15</span>) <span class='op'>+</span> (<span class='kw'>data</span>[[<span class='kw'>x</span>]] <span class='op'>&lt;=</span> <span class='fl'>80</span>)<span class='op'>*</span><span class='kw'>data</span>[[<span class='kw'>x</span>]]
<span class='kw'>psi1.2</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>ex1_dat</span>, <span class='st'>"A"</span>, <span class='st'>"Y"</span>, <span class='st'>"W"</span>, shift = <span class='kw'>d</span>,
                    outcome_type = <span class='st'>"continuous"</span>, folds = <span class='fl'>2</span>)
<span class='kw'>psi1.2</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 507.7539</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 2.1</span>
<span class='co'># Longitudinal setting, time-varying continuous exposure bounded by 0,</span>
<span class='co'># time-varying covariates, and a binary outcome with no loss-to-follow-up.</span>
<span class='co'># Interested in the effect of a treatment policy where exposure decreases by</span>
<span class='co'># one unit at every time point if an observations observed exposure is greater</span>
<span class='co'># than or equal to 2. The true value under this intervention is about 0.305.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='kw'>sim_t4</span>)
</div><div class='output co'>#&gt;   ID L_1 A_1 L_2 A_2 L_3 A_3 L_4 A_4 Y
#&gt; 1  1   2   3   0   1   1   1   1   3 0
#&gt; 2  2   2   1   1   4   0   3   1   2 0
#&gt; 3  3   1   0   1   3   1   2   1   1 1
#&gt; 4  4   1   0   0   3   1   3   1   2 0
#&gt; 5  5   3   3   1   1   0   1   1   2 0
#&gt; 6  6   1   0   0   2   0   3   1   4 0</div><div class='input'><span class='co'># specifying treament variables</span>
<span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"A_1"</span>, <span class='st'>"A_2"</span>, <span class='st'>"A_3"</span>, <span class='st'>"A_4"</span>)
<span class='co'># specifying time varying covariates</span>
<span class='kw'>tv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_1"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_2"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_3"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_4"</span>))
<span class='co'># treatment policy function to be applied at all time points</span>
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>) {
  <span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='kw'>data</span>[[<span class='kw'>trt</span>]]
  (<span class='kw'>a</span> <span class='op'>-</span> <span class='fl'>1</span>) <span class='op'>*</span> (<span class='kw'>a</span> <span class='op'>-</span> <span class='fl'>1</span> <span class='op'>&gt;=</span> <span class='fl'>1</span>) <span class='op'>+</span> <span class='kw'>a</span> <span class='op'>*</span> (<span class='kw'>a</span> <span class='op'>-</span> <span class='fl'>1</span> <span class='op'>&lt;</span> <span class='fl'>1</span>)
}
<span class='kw'>progressr</span>::<span class='fu'><a href='https://rdrr.io/pkg/progressr/man/with_progress.html'>with_progress</a></span>({
  <span class='kw'>psi2.1</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_t4</span>, <span class='kw'>a</span>, <span class='st'>"Y"</span>, time_vary = <span class='kw'>tv</span>, shift = <span class='kw'>d</span>, folds = <span class='fl'>2</span>)
})
<span class='kw'>psi2.1</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.2605</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 2.2</span>
<span class='co'># Example 2.1 assumed that the outcome (as well as the treatment variables)</span>
<span class='co'># were directly affected by all other nodes in the past. In certain situtations,</span>
<span class='co'># domain specific knowledge may suggest otherwise leading to a Markov processes.</span>
<span class='co'># This can be controlled using the k argument.</span>
<span class='kw'>progressr</span>::<span class='fu'><a href='https://rdrr.io/pkg/progressr/man/with_progress.html'>with_progress</a></span>({
  <span class='kw'>psi2.2</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_t4</span>, <span class='kw'>a</span>, <span class='st'>"Y"</span>, time_vary = <span class='kw'>tv</span>, shift = <span class='kw'>d</span>,
                      k = <span class='fl'>0</span>, folds = <span class='fl'>2</span>)
})
<span class='kw'>psi2.2</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.2514</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 2.3</span>
<span class='co'># Using the same data as examples 2.1 and 2.2.</span>
<span class='co'># Now estimating the effect of a dynamic modified treatment policy.</span>
<span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"A_1"</span>, <span class='st'>"A_2"</span>, <span class='st'>"A_3"</span>, <span class='st'>"A_4"</span>)
<span class='kw'>time_varying</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_1"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_2"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_3"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L_4"</span>))
<span class='co'># our same shift function</span>
<span class='kw'>shift</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>) {
  (<span class='kw'>data</span>[[<span class='kw'>trt</span>]] <span class='op'>-</span> <span class='fl'>1</span>) <span class='op'>*</span> (<span class='kw'>data</span>[[<span class='kw'>trt</span>]] <span class='op'>-</span> <span class='fl'>1</span> <span class='op'>&gt;=</span> <span class='fl'>1</span>) <span class='op'>+</span> <span class='kw'>data</span>[[<span class='kw'>trt</span>]] <span class='op'>*</span> (<span class='kw'>data</span>[[<span class='kw'>trt</span>]] <span class='op'>-</span> <span class='fl'>1</span> <span class='op'>&lt;</span> <span class='fl'>1</span>)
}
<span class='co'># creating a dynamic mtp that applies the shift function</span>
<span class='co'># but also depends on history and the current time</span>
<span class='kw'>dynamic_mtp</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>) {
  <span class='co'>if</span> (<span class='kw'>trt</span> <span class='op'>==</span> <span class='st'>"A_1"</span>) {
    <span class='co'># if its the first time point, follow the same mtp as before</span>
    <span class='fu'>shift</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>)
  } <span class='co'>else</span> {
    <span class='co'># otherwise check if the time varying covariate equals 1</span>
    <span class='fu'><a href='https://rdrr.io/r/base/ifelse.html'>ifelse</a></span>(<span class='kw'>data</span>[[<span class='fu'><a href='https://rdrr.io/r/base/grep.html'>sub</a></span>(<span class='st'>"A"</span>, <span class='st'>"L"</span>, <span class='kw'>trt</span>)]] <span class='op'>==</span> <span class='fl'>1</span>,
           <span class='fu'>shift</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>), <span class='co'># if yes continue with the policy</span>
           <span class='kw'>data</span>[[<span class='kw'>trt</span>]]) <span class='co'># otherwise do nothing</span>
  }
}
<span class='kw'>psi2.3</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_t4</span>, <span class='kw'>a</span>, <span class='st'>"Y"</span>, time_vary = <span class='kw'>time_varying</span>,
                   k = <span class='fl'>0</span>, shift = <span class='kw'>dynamic_mtp</span>, folds = <span class='fl'>2</span>)
<span class='kw'>psi2.3</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(dynamic_mtp)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.2339</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 2.4</span>
<span class='co'># Using the same data as examples 2.1, 2.2, and 2.3, but now treating the exposure</span>
<span class='co'># as an ordered categorical variable. To account for the exposure being a</span>
<span class='co'># factor we just need to modify the shift function (and the original data)</span>
<span class='co'># so as to respect this.</span>
<span class='co'>for</span> (<span class='kw'>i</span> <span class='co'>in</span> <span class='kw'>a</span>) {
  <span class='kw'>sim_t4</span>[[<span class='kw'>i</span>]] <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='kw'>sim_t4</span>[[<span class='kw'>i</span>]], levels = <span class='fl'>0</span><span class='op'>:</span><span class='fl'>5</span>, ordered = <span class='fl'>TRUE</span>)
}
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>trt</span>) {
  <span class='kw'>out</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>()
  <span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='kw'>data</span>[[<span class='kw'>trt</span>]]
  <span class='co'>for</span> (<span class='kw'>i</span> <span class='co'>in</span> <span class='fl'>1</span><span class='op'>:</span><span class='fu'><a href='https://rdrr.io/r/base/length.html'>length</a></span>(<span class='kw'>a</span>)) {
    <span class='co'>if</span> (<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='kw'>a</span>[<span class='kw'>i</span>]) <span class='op'>%in%</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"0"</span>, <span class='st'>"1"</span>)) {
      <span class='kw'>out</span>[[<span class='kw'>i</span>]] <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='kw'>a</span>[<span class='kw'>i</span>])
    } <span class='co'>else</span> {
      <span class='kw'>out</span>[[<span class='kw'>i</span>]] <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/numeric.html'>as.numeric</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/character.html'>as.character</a></span>(<span class='kw'>a</span>[<span class='kw'>i</span>])) <span class='op'>-</span> <span class='fl'>1</span>
    }
  }
  <span class='fu'><a href='https://rdrr.io/r/base/factor.html'>factor</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/unlist.html'>unlist</a></span>(<span class='kw'>out</span>), levels = <span class='fl'>0</span><span class='op'>:</span><span class='fl'>5</span>, ordered = <span class='fl'>TRUE</span>)
}
<span class='kw'>progressr</span>::<span class='fu'><a href='https://rdrr.io/pkg/progressr/man/with_progress.html'>with_progress</a></span>({
  <span class='kw'>psi2.4</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_t4</span>, <span class='kw'>a</span>, <span class='st'>"Y"</span>, time_vary = <span class='kw'>tv</span>, shift = <span class='kw'>d</span>, k = <span class='fl'>0</span>, folds = <span class='fl'>2</span>)
})
<span class='kw'>psi2.4</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.3222</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 3.1</span>
<span class='co'># Longitudinal setting, time-varying binary treatment, time-varying covariates</span>
<span class='co'># and baseline covariates with no loss-to-follow-up. Interested in a traditional</span>
<span class='co'># causal effect where treatment is set to 1 at all time points for all observations.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/data.html'>data</a></span>(<span class='st'>"iptwExWide"</span>, package = <span class='st'>"twang"</span>)
<span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"tx"</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>3</span>)
<span class='kw'>baseline</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"gender"</span>, <span class='st'>"age"</span>)
<span class='kw'>tv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"use0"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"use1"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"use2"</span>))
<span class='kw'>progressr</span>::<span class='fu'><a href='https://rdrr.io/pkg/progressr/man/with_progress.html'>with_progress</a></span>({
  <span class='kw'>psi3.1</span> <span class='op'>&lt;-</span>
    <span class='fu'>lmtp_sub</span>(<span class='kw'>iptwExWide</span>, <span class='kw'>a</span>, <span class='st'>"outcome"</span>, baseline = <span class='kw'>baseline</span>, time_vary = <span class='kw'>tv</span>,
              shift = <span class='kw'>static_binary_on</span>, outcome_type = <span class='st'>"continuous"</span>,
              folds = <span class='fl'>2</span>)
})
<span class='kw'>psi3.1</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(static_binary_on)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: -0.3166</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 4.1</span>
<span class='co'># Longitudinal setting, time-varying continuous treatment, time-varying covariates,</span>
<span class='co'># binary outcome with right censoring. Interested in the mean population outcome under</span>
<span class='co'># the observed exposures in a hypothetical population with no loss-to-follow-up.</span>
<span class='fu'><a href='https://rdrr.io/r/utils/head.html'>head</a></span>(<span class='kw'>sim_cens</span>)
</div><div class='output co'>#&gt;   L1         A1 C1 L2         A2 C2 Y
#&gt; 1  0  0.7930531  1  0  0.4098544  1 0
#&gt; 2  1  3.9568969  1  1  7.1306144  1 1
#&gt; 3  0 -0.9803504  1  0 -2.7858973  1 0
#&gt; 4  1  0.8833268  1  1  1.1372421  1 1
#&gt; 5  1  3.1666751  1  1  7.4640462  1 1
#&gt; 6  1  3.5393771  1  1  9.5161813  1 1</div><div class='input'><span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"A1"</span>, <span class='st'>"A2"</span>)
<span class='kw'>tv</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/list.html'>list</a></span>(<span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L1"</span>), <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"L2"</span>))
<span class='kw'>cens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"C1"</span>, <span class='st'>"C2"</span>)
<span class='kw'>y</span> <span class='op'>&lt;-</span> <span class='st'>"Y"</span>
<span class='kw'>psi4.1</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_cens</span>, <span class='kw'>a</span>, <span class='kw'>y</span>, time_vary = <span class='kw'>tv</span>,
                   cens = <span class='kw'>cens</span>, shift = <span class='kw'>NULL</span>, folds = <span class='fl'>2</span>)
<span class='kw'>psi4.1</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(NULL)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.771</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 4.2</span>
<span class='co'># Using the same data as example 4.1, but now interested in the causal effect of a</span>
<span class='co'># treatment policy where exposure increased by 0.5 units at all time points. The</span>
<span class='co'># true value under this intervention is about 0.88.</span>
<span class='kw'>d</span> <span class='op'>&lt;-</span> <span class='fu'>function</span>(<span class='kw'>data</span>, <span class='kw'>x</span>) <span class='kw'>data</span>[[<span class='kw'>x</span>]] <span class='op'>+</span> <span class='fl'>0.5</span>
<span class='kw'>psi4.2</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_cens</span>, <span class='kw'>a</span>, <span class='kw'>y</span>, time_vary = <span class='kw'>tv</span>, cens = <span class='kw'>cens</span>, shift = <span class='kw'>d</span>, folds = <span class='fl'>2</span>)
<span class='kw'>psi4.2</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(d)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.8612</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'>
<span class='co'># Example 5.1</span>
<span class='co'># Time-to-event analysis with a binary time-invariant exposure. Interested in</span>
<span class='co'># the effect of treatment being given to all observations on the cumulative</span>
<span class='co'># incidence of our time-to-event outcome.</span>
<span class='kw'>a</span> <span class='op'>&lt;-</span> <span class='st'>"trt"</span>
<span class='co'># for a survival problem, the outcome arugment now takes a vector of outcomes</span>
<span class='co'># if an observation experiences the event prior to the end of follow-up, all future</span>
<span class='co'># outcome nodes should be set to 1 (i.e., last observation carried forward).</span>
<span class='kw'>y</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"Y."</span>, <span class='fl'>1</span><span class='op'>:</span><span class='fl'>6</span>)
<span class='kw'>cens</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/paste.html'>paste0</a></span>(<span class='st'>"C."</span>, <span class='fl'>0</span><span class='op'>:</span><span class='fl'>5</span>)
<span class='kw'>baseline</span> <span class='op'>&lt;-</span> <span class='fu'><a href='https://rdrr.io/r/base/c.html'>c</a></span>(<span class='st'>"W1"</span>, <span class='st'>"W2"</span>)
<span class='kw'>progressr</span>::<span class='fu'><a href='https://rdrr.io/pkg/progressr/man/with_progress.html'>with_progress</a></span>({
  <span class='kw'>psi5.1</span> <span class='op'>&lt;-</span> <span class='fu'>lmtp_sub</span>(<span class='kw'>sim_point_surv</span>, <span class='kw'>a</span>, <span class='kw'>y</span>, <span class='kw'>baseline</span>, cens = <span class='kw'>cens</span>,
                      shift = <span class='kw'>static_binary_on</span>, folds = <span class='fl'>2</span>)
})
<span class='kw'>psi5.1</span>
</div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>LMTP Estimator</span><span>: substitution</span></div><div class='output co'>#&gt;    </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Trt. Policy</span><span>: </span><span style='color: #0000BB;font-style: italic;'>(static_binary_on)</span><span></span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Population intervention effect</span><span></span></div><div class='output co'>#&gt;       </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Estimate</span><span>: 0.8048</span></div><div class='output co'>#&gt;     </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>Std. error</span><span>: NA</span></div><div class='output co'>#&gt;         </div><div class='output co'>#&gt; <span class='message'></span><span style='font-weight: bold;'>95% CI</span><span>: (NA, NA)</span></div><div class='output co'>#&gt; </div><div class='output co'>#&gt; <span class='message'></span><span style='color: #BBBB00;'>!</span><span> Standard errors aren't provided for the substitution estimator.</span></div><div class='output co'>#&gt; </div><div class='input'><span class='co'># }</span>
</div></span></pre>
  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top">
      <h2 data-toc-skip>Contents</h2>
    </nav>
  </div>
</div>


      <footer>
      <div class="copyright">
  <p>Developed by Nicholas Williams, Iván Díaz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
   </div>

  


  </body>
</html>


