<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Using LMTP • lmtp</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Using LMTP">
<meta property="og:description" content="lmtp">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">lmtp</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.0.8.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa fas fa-home fa-lg"></span>
     
  </a>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/intro-lmtp.html">Using LMTP</a>
    </li>
  </ul>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right"></ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Using LMTP</h1>
            
      
      
      <div class="hidden name"><code>intro-lmtp.Rmd</code></div>

    </div>

    
    
<style type="text/css">
.table {

    width: 50%;
    margin: 0 auto;  

}
</style>
<p><strong>Authors</strong>: <a href="https://nicholastwilliams.com">Nick Williams</a> and <a href="https://idiaz.xyz">Ivan Diaz</a><br><strong>Updated</strong>: 2020-05-17</p>
<p>This document serves as an introductory guide to using the <code>lmtp</code> package. <code>lmtp</code> provides an estimation framework for the casual effects of longitudinal modified treatment policies of continuous valued exposures using ensemble machine learning. While primarily developed to estimate the effect of continuous exposures, <code>lmtp</code> naturally extends to allowing the estimation of traditional causal effects based on binary exposure in both point treatment and time-varying situations.</p>
<p>While not possible to cover everything, this document should equip users of <code>lmtp</code> with enough knowledge to complete the majority of use cases.</p>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">lmtp</span>)
<span class="co">#&gt; lmtp: Causal Effects Based on Longitudinal Modified Treatment Policies</span>
<span class="co">#&gt; Version: 0.0.8.9000</span>
<span class="co">#&gt; </span></pre></body></html></div>
<div id="functions-parameters" class="section level2">
<h2 class="hasAnchor">
<a href="#functions-parameters" class="anchor"></a>Functions &amp; parameters</h2>
<blockquote>
<p>The goal of this section is to introduce the main <code>lmtp</code> functions and develop a basic understanding of required and useful function parameters.</p>
</blockquote>
<div id="the-estimators" class="section level3">
<h3 class="hasAnchor">
<a href="#the-estimators" class="anchor"></a>The estimators</h3>
<p><code>lmtp</code> supplies 2 main estimators:</p>
<ul>
<li>a targeted maximum likelihood (TML) estimator: <code><a href="../reference/lmtp_tmle.html">lmtp_tmle()</a></code>
</li>
<li>a sequentially doubly robust (SDR) estimator: <code><a href="../reference/lmtp_sdr.html">lmtp_sdr()</a></code>
</li>
</ul>
<p>Two auxillary estimators are also provided, however, the use of these estimators is recommended against in favors of the TML or SDR estimators:</p>
<ul>
<li>a substitution estimator: <code><a href="../reference/lmtp_sub.html">lmtp_sub()</a></code>
</li>
<li>an IPW estimator: <code><a href="../reference/lmtp_ipw.html">lmtp_ipw()</a></code>
</li>
</ul>
</div>
<div id="required-vs--optional" class="section level3">
<h3 class="hasAnchor">
<a href="#required-vs--optional" class="anchor"></a>Required vs. optional</h3>
<p>The following table describes <code>lmtp</code> parameter requirements across the provided estimators:</p>
<table class="table">
<thead><tr class="header">
<th>Parameter</th>
<th align="center">TMLE</th>
<th align="center">SDR</th>
<th align="center">Substitution</th>
<th align="center">IPW</th>
<th align="center">Required</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>data</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
</tr>
<tr class="even">
<td>trt</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
</tr>
<tr class="odd">
<td>outcome</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
</tr>
<tr class="even">
<td>nodes</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
</tr>
<tr class="odd">
<td>baseline</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
</tr>
<tr class="even">
<td>cens</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>k</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
</tr>
<tr class="even">
<td>shift</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
</tr>
<tr class="odd">
<td>outcome_type</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>bounds</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>learners</td>
<td align="center"></td>
<td align="center"></td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
</tr>
<tr class="even">
<td>learners_outcome</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="odd">
<td>learners_trt</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
<td align="center"></td>
<td align="center"></td>
</tr>
<tr class="even">
<td>folds</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center">✓</td>
<td align="center"></td>
</tr>
</tbody>
</table>
<p><br></p>
<p>While many parameters aren’t required, the default options will likely give subpar (or incorrect) results. Special attention should be given to the <code>k</code> parameter which is fully described in the <a href="#node-lists-markov-processes">Node lists &amp; Markov processes</a> section.</p>
</div>
<div id="sl3" class="section level3">
<h3 class="hasAnchor">
<a href="#sl3" class="anchor"></a>sl3</h3>
<p><code>lmtp</code> relies on the <code>sl3</code> package to use ensemble machine learning during estimation procedures. To fully take advantage of the estimators supplied by <code>lmtp</code>, users must create and then pass to <code>lmtp</code> estimators <code>sl3</code> learner stacks. <code>sl3</code> learner stacks are passed to <code>lmtp</code> estimators either through the <code>learners</code> argument for <code><a href="../reference/lmtp_sub.html">lmtp_sub()</a></code> and <code><a href="../reference/lmtp_ipw.html">lmtp_ipw()</a></code> or the <code>learners_trt</code> and <code>learners_outcome</code> arguments for <code><a href="../reference/lmtp_tmle.html">lmtp_tmle()</a></code> and <code><a href="../reference/lmtp_sdr.html">lmtp_sdr()</a></code>. A full list of supplied <code>sl3</code> learners can be found <a href="https://tlverse.org/sl3/reference/index.html">here</a>.</p>
<p>The easiest way to create an <code>sl3</code> learner stack is using <code><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">sl3::make_learner_stack()</a></code>.</p>
<div class="sourceCode" id="cb2"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">sl3</span>)

<span class="co"># using learner defaults</span>
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(<span class="no">Lrnr_mean</span>,
                            <span class="no">Lrnr_glm</span>,
                            <span class="no">Lrnr_ranger</span>)

<span class="co"># specifying learner parameters</span>
<span class="no">lrnrs</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(
    <span class="no">Lrnr_mean</span>,
    <span class="no">Lrnr_glm</span>,
    <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="no">Lrnr_ranger</span>,
         <span class="kw">num.trees</span> <span class="kw">=</span> <span class="fl">1000</span>)
  )</pre></body></html></div>
<p>The outcome type should guide users on selecting the appropriate learners for a stack when specifying <code>learners</code> with <code><a href="../reference/lmtp_sub.html">lmtp_sub()</a></code> or <code>learners_outcome</code> with <code><a href="../reference/lmtp_tmle.html">lmtp_tmle()</a></code> and <code><a href="../reference/lmtp_sdr.html">lmtp_sdr()</a></code>. Regardless of whether an exposure/treatment is continuous or binary, the exposure mechanism is estimated through classification, thus users should only use <code>sl3</code> learners that can handle a binary outcome when specifying <code>learners</code> with <code><a href="../reference/lmtp_ipw.html">lmtp_ipw()</a></code> or <code>learners_trt</code> with <code><a href="../reference/lmtp_tmle.html">lmtp_tmle()</a></code> or <code><a href="../reference/lmtp_sdr.html">lmtp_sdr()</a></code>.</p>
<p>The ensemble meta-learner is always set to <code>Lrnr_nnls</code>. If learner stacks aren’t provided, <code>lmtp</code> estimators default to an ensemble only made of <code>Lrnr_mean</code> and <code>Lrnr_glm</code>.</p>
<p><strong>It is recommended the user reads through the <code>sl3</code> <a href="https://tlverse.org/sl3/index.html">documentation</a> to fully utilize <code>lmtp</code>.</strong></p>
</div>
<div id="node-lists-markov-processes" class="section level3">
<h3 class="hasAnchor">
<a href="#node-lists-markov-processes" class="anchor"></a>Node lists &amp; Markov processes</h3>
<p>Estimating causal effects in longitudinal settings requires paying special attention to the time-ordering and relationship among covariates. In the <code>lmtp</code> framework, there are 5 types of variable nodes: treatment, outcome, baseline, time-varying, and censoring. Treatment and outcome nodes are self-explanatory, baseline nodes are variables that are observed pre-treatment allocation and don’t change (i.e., age at treatment assignment), time-varying nodes are variables that (you guessed it…) change over time, censoring nodes indicate if an observation is observed (or censored) at the next time-point.</p>
<p>How these nodes are specified depends on the specific data generating mechanism and should be pre-specified based on a conceptual model (i.e, a DAG). How these nodes are used by <code>lmtp</code> estimators is specified by what we’re calling a node list. The user doesn’t explicitly create the node list themself, instead the user supplies the ingredients and instructions on how to combine. These node list <em>cooking</em> instructions are specified through the <code>k</code> parameter.</p>
<p>This is best understood through demonstration. The following DAG specifies 1 baseline node, <code>W</code>, 3 treatment nodes, <code>A1</code>, <code>A2</code>, <code>A3</code>, 3 time-varying nodes, <code>L1</code>, <code>L2</code>, <code>L3</code>, and an outcome, <code>Y</code>.</p>
<p><img src="dag-1.png" width="80%"></p>
<p>According to the DAG, <code>Y</code> is directly affected by all nodes in the model, <code>k = Inf</code> would be the correct instructions for creating this node list.</p>
<div class="sourceCode" id="cb3"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"W"</span>, <span class="st">"L1"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L2"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L3"</span>))

<span class="co"># we can make sure our specification is correct by checking create_node_list()</span>
<span class="fu"><a href="../reference/create_node_list.html">create_node_list</a></span>(<span class="no">a</span>, <span class="no">nodes</span>, <span class="kw">baseline</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">Inf</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "W"  "L1" "A1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "W"  "L1" "A1" "L2" "A2"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "W"  "L1" "A1" "L2" "A2" "L3" "A3"</span></pre></body></html></div>
<p>What if we modify the DAG so that <code>Y</code> is only directly affected by <code>A2</code>, <code>L2</code>, and <code>W</code>. We could say this data generating mechanism is now semi-Markov and the correct <code>k</code> would be <code>k = 1</code>.</p>
<p><img src="dag-2.png" width="80%"></p>
<div class="sourceCode" id="cb4"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>, <span class="st">"A3"</span>)
<span class="no">baseline</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"W"</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L1"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L2"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L3"</span>))

<span class="co"># again checking or specification</span>
<span class="fu"><a href="../reference/create_node_list.html">create_node_list</a></span>(<span class="no">a</span>, <span class="no">nodes</span>, <span class="kw">baseline</span> <span class="kw">=</span> <span class="no">baseline</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>)
<span class="co">#&gt; [[1]]</span>
<span class="co">#&gt; [1] "W"  "L1" "A1"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[2]]</span>
<span class="co">#&gt; [1] "W"  "L1" "A1" "L2" "A2"</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; [[3]]</span>
<span class="co">#&gt; [1] "W"  "L2" "A2" "L3" "A3"</span></pre></body></html></div>
<p>Censoring nodes are discussed in the <a href="#censored-outcomes">Censored outcomes</a> section.</p>
</div>
</div>
<div id="calculating-effects" class="section level2">
<h2 class="hasAnchor">
<a href="#calculating-effects" class="anchor"></a>Calculating effects</h2>
<blockquote>
<p>The goal of this section is to identify how to estimate different causal effects using <code>lmtp</code> estimators.</p>
</blockquote>
<div id="traditional-causal-effects" class="section level3">
<h3 class="hasAnchor">
<a href="#traditional-causal-effects" class="anchor"></a>Traditional causal effects</h3>
<p><span class="math display">\[d_t(a_t, h_t) = a_t - \delta_t\]</span></p>
</div>
<div id="modified-treatment-policies" class="section level3">
<h3 class="hasAnchor">
<a href="#modified-treatment-policies" class="anchor"></a>Modified treatment policies</h3>
<p>Consider a hypothetical intervention where a treatment/exposure is shifted for a set of user-given regimes. The regime only depends upon the natural value of treatment/exposure and other covariate history.</p>
<p><span class="math display">\[
d_t(a_t, h_t)=\left\{ \begin{array}{l}
    a_t - \delta_t &amp; \text{if $a_t&gt;u_t(h_t) + \delta_t$}\\
    a_t &amp; \text{if $a_t \leq u_t(h_t) + \delta_t$}\\
  \end{array} \right.
\]</span> This intervention differs from the traditional counterparts in that it only considers a hypothetical intervention where treatment/exposure is shifted, <span class="math inline">\(\delta_t\)</span>, for observations where this shift is realistic (what’s realistic in this case is defined by <span class="math inline">\(a_t&gt;u_t(h_t) + \delta_t\)</span>).</p>
</div>
<div id="shift-functions" class="section level3">
<h3 class="hasAnchor">
<a href="#shift-functions" class="anchor"></a>Shift functions</h3>
<p>To estimate the effect of a traditional causal intervention or a modified treatment policy in <code>lmtp</code> we need to translate these interventions into a shift function. Shift functions are applied to treatment nodes at each time point. A shift function for a traditional intervention where the exposure decreases by 1 unit for all observations at every time point would look like:</p>
<div class="sourceCode" id="cb5"><html><body><pre class="r"><span class="no">shift</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">trt</span>) {
  <span class="no">trt</span> - <span class="fl">1</span>
}</pre></body></html></div>
<p>In contrast, we may interested in the effect of a modified treatment policy where exposure is decreased by 1 unit only among subjects whose exposure won’t go below 1 if intervened upon:</p>
<div class="sourceCode" id="cb6"><html><body><pre class="r"><span class="no">shift</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">trt</span>) {
  (<span class="no">trt</span> - <span class="fl">1</span>) * (<span class="no">trt</span> - <span class="fl">1</span> <span class="kw">&gt;=</span> <span class="fl">1</span>) + <span class="no">trt</span> * (<span class="no">trt</span> - <span class="fl">1</span> <span class="kw">&lt;</span> <span class="fl">1</span>)
}</pre></body></html></div>
<p>Shift functions are passed to lmtp estimators through the <code>shift</code> argument. Currently, shift functions can only depend on the value of the current treatment node. However, the ability evaluate dynamic treatment regimes will be established in a future version.</p>
<div class="sourceCode" id="cb7"><html><body><pre class="r"><span class="co"># using the previous shift function with sdr</span>
<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A_1"</span>, <span class="st">"A_2"</span>, <span class="st">"A_3"</span>, <span class="st">"A_4"</span>)
<span class="no">time_varying</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_2"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_3"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_4"</span>))
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(<span class="no">Lrnr_mean</span>, <span class="no">Lrnr_glm</span>)

<span class="fu"><a href="../reference/lmtp_sdr.html">lmtp_sdr</a></span>(<span class="no">sim_t4</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">time_varying</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">shift</span>,
         <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co">#&gt; LMTP Estimator: SDR</span>
<span class="co">#&gt;    Trt. Policy: (shift)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population intervention effect</span>
<span class="co">#&gt;       Estimate: 0.2563</span>
<span class="co">#&gt;     Std. error: 0.0165</span>
<span class="co">#&gt;         95% CI: (0.2241, 0.2886)</span></pre></body></html></div>
<div id="binary-treatment" class="section level4">
<h4 class="hasAnchor">
<a href="#binary-treatment" class="anchor"></a>Binary treatment</h4>
<p>In the case of a binary treatment/exposure the shift function would simply set treatment/exposure to either 0 or 1 depending on the effect of interest:</p>
<div class="sourceCode" id="cb8"><html><body><pre class="r"><span class="co"># set exposure to 1 for all observations at all time points</span>
<span class="no">shift</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fl">1</span>

<span class="co"># set exposure to 0 for all observations at all time points</span>
<span class="no">shift_0</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="fl">0</span>

<span class="co"># a binary trt example</span>
<span class="fu"><a href="https://rdrr.io/r/utils/data.html">data</a></span>(<span class="st">"iptwExWide"</span>, <span class="kw">package</span> <span class="kw">=</span> <span class="st">"twang"</span>)

<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/paste.html">paste0</a></span>(<span class="st">"tx"</span>, <span class="fl">1</span>:<span class="fl">3</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"gender"</span>, <span class="st">"age"</span>, <span class="st">"use0"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"use1"</span>),
              <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"use2"</span>))
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(<span class="no">Lrnr_mean</span>, <span class="no">Lrnr_glm</span>)

<span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">iptwExWide</span>, <span class="no">a</span>, <span class="st">"outcome"</span>, <span class="no">nodes</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">shift</span>,
          <span class="kw">outcome_type</span> <span class="kw">=</span> <span class="st">"continuous"</span>,
          <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">5</span>)
<span class="co">#&gt; LMTP Estimator: TMLE</span>
<span class="co">#&gt;    Trt. Policy: (shift)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population intervention effect</span>
<span class="co">#&gt;       Estimate: -0.287</span>
<span class="co">#&gt;     Std. error: 0.07</span>
<span class="co">#&gt;         95% CI: (-0.4242, -0.1497)</span></pre></body></html></div>
</div>
</div>
<div id="censored-outcomes" class="section level3">
<h3 class="hasAnchor">
<a href="#censored-outcomes" class="anchor"></a>Censored outcomes</h3>
<p>In the (likely) case of missing outcomes, <code>lmtp</code> can estimate the effect of a hypothetical treatment regime where all observations remained uncensored at end of follow-up. To do this, the user must supply a character vector of censoring nodes for each treatment time point to <code>lmtp</code> estimators through the <code>cens</code> argument. Censoring nodes should be defined such that at any time, <span class="math inline">\(t\)</span>, if an observation is observed at time <span class="math inline">\(t + 1\)</span> they receive a 1 and a 0 otherwise.</p>
<p><strong>Note: Censoring nodes must be provided if there are missing outcomes.</strong></p>
<div class="sourceCode" id="cb9"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_cens</span>[<span class="no">sim_cens</span>$<span class="no">C1</span> <span class="kw">==</span> <span class="fl">1</span>, ])
<span class="co">#&gt;   L1         A1 C1 L2         A2 C2 Y</span>
<span class="co">#&gt; 1  0  0.7930531  1  0  0.4098544  1 0</span>
<span class="co">#&gt; 2  1  3.9568969  1  1  7.1306144  1 1</span>
<span class="co">#&gt; 3  0 -0.9803504  1  0 -2.7858973  1 0</span>
<span class="co">#&gt; 4  1  0.8833268  1  1  1.1372421  1 1</span>
<span class="co">#&gt; 5  1  3.1666751  1  1  7.4640462  1 1</span>
<span class="co">#&gt; 6  1  3.5393771  1  1  9.5161813  1 1</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_cens</span>[<span class="no">sim_cens</span>$<span class="no">C1</span> <span class="kw">==</span> <span class="fl">0</span>, ])
<span class="co">#&gt;     L1       A1 C1 L2 A2 C2  Y</span>
<span class="co">#&gt; 48   1 3.260499  0 NA NA  0 NA</span>
<span class="co">#&gt; 58   1 1.109737  0 NA NA  0 NA</span>
<span class="co">#&gt; 67   1 1.376540  0 NA NA  0 NA</span>
<span class="co">#&gt; 112  1 3.832451  0 NA NA  0 NA</span>
<span class="co">#&gt; 114  1 1.241776  0 NA NA  0 NA</span>
<span class="co">#&gt; 115  1 2.390811  0 NA NA  0 NA</span>

<span class="fu"><a href="https://rdrr.io/r/utils/head.html">head</a></span>(<span class="no">sim_cens</span>[<span class="no">sim_cens</span>$<span class="no">C2</span> <span class="kw">==</span> <span class="fl">0</span>, ])
<span class="co">#&gt;    L1         A1 C1 L2         A2 C2  Y</span>
<span class="co">#&gt; 30  0 -1.5671983  1  1 -2.9243170  0 NA</span>
<span class="co">#&gt; 40  1 -0.2911170  1  1  1.5954122  0 NA</span>
<span class="co">#&gt; 48  1  3.2604987  0 NA         NA  0 NA</span>
<span class="co">#&gt; 55  0 -0.4747829  1  1  0.2138251  0 NA</span>
<span class="co">#&gt; 58  1  1.1097371  0 NA         NA  0 NA</span>
<span class="co">#&gt; 67  1  1.3765396  0 NA         NA  0 NA</span></pre></body></html></div>
<div class="sourceCode" id="cb10"><html><body><pre class="r"><span class="co"># estimating an effect when there is censoring</span>
<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L2"</span>))
<span class="no">cens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_glm</span>)

<span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_cens</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">nodes</span>, <span class="kw">cens</span> <span class="kw">=</span> <span class="no">cens</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>,
          <span class="kw">shift</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span> + <span class="fl">0.5</span>, <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>,
          <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>)
<span class="co">#&gt; LMTP Estimator: TMLE</span>
<span class="co">#&gt;    Trt. Policy: (function(x) x + 0.5)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population intervention effect</span>
<span class="co">#&gt;       Estimate: 0.8869</span>
<span class="co">#&gt;     Std. error: 0.0149</span>
<span class="co">#&gt;         95% CI: (0.8577, 0.916)</span></pre></body></html></div>
<div id="population-mean-outcome" class="section level4">
<h4 class="hasAnchor">
<a href="#population-mean-outcome" class="anchor"></a>Population mean outcome</h4>
<p>In certain situtations, the user may be interested in the population mean outcome under no intervention. In the presence of censoring, this can be estimated by setting <code>shift = NULL</code> and indicating censoring nodes.</p>
<div class="sourceCode" id="cb11"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L2"</span>))
<span class="no">cens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_glm</span>)

<span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_cens</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">nodes</span>, <span class="kw">cens</span> <span class="kw">=</span> <span class="no">cens</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>,
          <span class="kw">shift</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>,
          <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>)
<span class="co">#&gt; LMTP Estimator: TMLE</span>
<span class="co">#&gt;    Trt. Policy: (NULL)</span>
<span class="co">#&gt; </span>
<span class="co">#&gt; Population intervention effect</span>
<span class="co">#&gt;       Estimate: 0.7978</span>
<span class="co">#&gt;     Std. error: 0.0142</span>
<span class="co">#&gt;         95% CI: (0.7701, 0.8256)</span></pre></body></html></div>
</div>
</div>
<div id="calculating-contrasts" class="section level3">
<h3 class="hasAnchor">
<a href="#calculating-contrasts" class="anchor"></a>Calculating contrasts</h3>
<p>The effects returned by the base <code>lmtp</code> functions are population intervention effects, that is the expected mean outcome in the population under the hypothetical intervention. Often, however, we are interested also in the comparison of different interventions to each other or to no intervention at all. This is the role of <code><a href="../reference/lmtp_contrast.html">lmtp_contrast()</a></code>.</p>
<div class="sourceCode" id="cb12"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A1"</span>, <span class="st">"A2"</span>)
<span class="no">nodes</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L2"</span>))
<span class="no">cens</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"C1"</span>, <span class="st">"C2"</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_glm</span>)

<span class="no">fit_shift</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_cens</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">nodes</span>, <span class="kw">cens</span> <span class="kw">=</span> <span class="no">cens</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>,
            <span class="kw">shift</span> <span class="kw">=</span> <span class="kw">function</span>(<span class="no">x</span>) <span class="no">x</span> + <span class="fl">0.5</span>, <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>,
            <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="no">fit_noshift</span> <span class="kw">&lt;-</span>
  <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_cens</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">nodes</span>, <span class="kw">cens</span> <span class="kw">=</span> <span class="no">cens</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>,
            <span class="kw">shift</span> <span class="kw">=</span> <span class="kw">NULL</span>, <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>,
            <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="fu"><a href="../reference/lmtp_contrast.html">lmtp_contrast</a></span>(<span class="no">fit_shift</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="no">fit_noshift</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"additive"</span>)
<span class="co">#&gt;   LMTP Contrast: additive</span>
<span class="co">#&gt; Null hypothesis: theta == 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    theta shift   ref std.error conf.low conf.high p.value</span>
<span class="co">#&gt; 1 0.0995 0.897 0.797   0.00985   0.0802     0.119  &lt;0.001</span>

<span class="fu"><a href="../reference/lmtp_contrast.html">lmtp_contrast</a></span>(<span class="no">fit_shift</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="no">fit_noshift</span>, <span class="kw">type</span> <span class="kw">=</span> <span class="st">"rr"</span>)
<span class="co">#&gt;   LMTP Contrast: relative risk</span>
<span class="co">#&gt; Null hypothesis: theta == 1</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   theta shift   ref std.error conf.low conf.high p.value</span>
<span class="co">#&gt; 1  1.12 0.897 0.797    0.0117      1.1      1.15  &lt;0.001</span></pre></body></html></div>
<p>Any number of <code>lmtp</code> fits can specified in <code><a href="../reference/lmtp_contrast.html">lmtp_contrast()</a></code> to be compared to either single reference fit or a known scalar.</p>
<div class="sourceCode" id="cb13"><html><body><pre class="r"><span class="fu"><a href="../reference/lmtp_contrast.html">lmtp_contrast</a></span>(<span class="no">fit_shift</span>, <span class="no">fit_noshift</span>, <span class="kw">ref</span> <span class="kw">=</span> <span class="fl">0.787</span>)
<span class="co">#&gt; Non-estimated reference value, defaulting type = 'additive'.</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;   LMTP Contrast: additive</span>
<span class="co">#&gt; Null hypothesis: theta == 0</span>
<span class="co">#&gt; </span>
<span class="co">#&gt;    theta shift   ref std.error conf.low conf.high p.value</span>
<span class="co">#&gt; 1 0.1099 0.897 0.787    0.0150   0.0805    0.1393  &lt;0.001</span>
<span class="co">#&gt; 2 0.0104 0.797 0.787    0.0142  -0.0174    0.0382   0.464</span></pre></body></html></div>
</div>
<div id="bootstrap-for-sub-ipw" class="section level3">
<h3 class="hasAnchor">
<a href="#bootstrap-for-sub-ipw" class="anchor"></a>Bootstrap for sub &amp; IPW</h3>
<p>There is no theory to provide standard errors for the substitution or IPW estimator when using data adaptive estimation procedures such as the super learner. Standard errors are thus not provided for the substution and IPW estimators. However, if using a pre-specified parametric model for estimation, (i.e., only including <code>Lrnr_glm</code>), inference can be performed using the non-parametric boostrap.</p>
<div class="sourceCode" id="cb14"><html><body><pre class="r"><span class="no">resamples</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">50</span>) {
  <span class="no">resamples</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="no">sim_t4</span>[<span class="fl">1</span>:<span class="fl">100</span>, ][<span class="fu"><a href="https://rdrr.io/r/base/sample.html">sample</a></span>(<span class="fl">1</span>:<span class="fl">100</span>, <span class="kw">replace</span> <span class="kw">=</span> <span class="no">T</span>), ]
}

<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A_1"</span>, <span class="st">"A_2"</span>, <span class="st">"A_3"</span>, <span class="st">"A_4"</span>)
<span class="no">time_varying</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_2"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_3"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_4"</span>))
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">a</span>) (<span class="no">a</span> - <span class="fl">1</span>) * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&gt;=</span> <span class="fl">1</span>) + <span class="no">a</span> * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&lt;</span> <span class="fl">1</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/Lrnr_base.html">make_learner</a></span>(<span class="no">Lrnr_glm</span>)

<span class="no">theta</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>()
<span class="kw">for</span> (<span class="no">i</span> <span class="kw">in</span> <span class="fl">1</span>:<span class="fl">50</span>) {
  <span class="no">theta</span><span class="kw">[[</span><span class="no">i</span>]] <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lmtp_ipw.html">lmtp_ipw</a></span>(<span class="no">resamples</span><span class="kw">[[</span><span class="no">i</span>]], <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">time_varying</span>,
                         <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">d</span>, <span class="kw">learners</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">2</span>)$<span class="no">theta</span>
}

<span class="fu"><a href="https://rdrr.io/r/stats/quantile.html">quantile</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/unlist.html">unlist</a></span>(<span class="no">theta</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="fl">0.025</span>, <span class="fl">0.975</span>))
<span class="co">#&gt;       2.5%      97.5% </span>
<span class="co">#&gt; 0.07720175 0.40026962 </span></pre></body></html></div>
</div>
</div>
<div id="extra-features" class="section level2">
<h2 class="hasAnchor">
<a href="#extra-features" class="anchor"></a>Extra features</h2>
<blockquote>
<p>The goal of this section is to identify extra features supported by <code>lmtp</code> that can improve user experience.</p>
</blockquote>
<div id="tidy-results" class="section level3">
<h3 class="hasAnchor">
<a href="#tidy-results" class="anchor"></a>Tidy results</h3>
<p><code>lmtp</code> automatically provides a <code>tidy</code> method as described in the <a href="https://cran.r-project.org/web/packages/broom/index.html"><code>broom</code></a> package:</p>
<div class="sourceCode" id="cb15"><html><body><pre class="r"><span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A_1"</span>, <span class="st">"A_2"</span>, <span class="st">"A_3"</span>, <span class="st">"A_4"</span>)
<span class="no">time_varying</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_2"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_3"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_4"</span>))
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">a</span>) (<span class="no">a</span> - <span class="fl">1</span>) * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&gt;=</span> <span class="fl">1</span>) + <span class="no">a</span> * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&lt;</span> <span class="fl">1</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(<span class="no">Lrnr_glm</span>)

<span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_t4</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">time_varying</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">d</span>,
                 <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">2</span>)

<span class="fu"><a href="https://rdrr.io/pkg/generics/man/tidy.html">tidy</a></span>(<span class="no">fit</span>)
<span class="co">#&gt; # A tibble: 1 x 5</span>
<span class="co">#&gt;   estimator estimate std.error conf.low conf.high</span>
<span class="co">#&gt;   &lt;chr&gt;        &lt;dbl&gt;     &lt;dbl&gt;    &lt;dbl&gt;     &lt;dbl&gt;</span>
<span class="co">#&gt; 1 TMLE         0.259    0.0176    0.224     0.293</span></pre></body></html></div>
</div>
<div id="parallel-processing-with-future" class="section level3">
<h3 class="hasAnchor">
<a href="#parallel-processing-with-future" class="anchor"></a>Parallel processing with future</h3>
<p>Computation time can quickly increase in situations with lots of time points, complex ensemble learners, and large datasets. In response, <code>lmtp</code> provides support for parallel processing using the <a href="https://cran.r-project.org/web/packages/future/index.html"><code>future</code></a> package. The simplest way to use <code>lmtp</code> estimators in parallel is set <code><a href="https://rdrr.io/pkg/future/man/plan.html">plan(multiprocess)</a></code>.</p>
<div class="sourceCode" id="cb16"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">future</span>)

<span class="no">a</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"A_1"</span>, <span class="st">"A_2"</span>, <span class="st">"A_3"</span>, <span class="st">"A_4"</span>)
<span class="no">time_varying</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html">list</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_1"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_2"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_3"</span>), <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"L_4"</span>))
<span class="no">d</span> <span class="kw">&lt;-</span> <span class="kw">function</span>(<span class="no">a</span>) (<span class="no">a</span> - <span class="fl">1</span>) * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&gt;=</span> <span class="fl">1</span>) + <span class="no">a</span> * (<span class="no">a</span> - <span class="fl">1</span> <span class="kw">&lt;</span> <span class="fl">1</span>)
<span class="no">lrnrs</span> <span class="kw">&lt;-</span> <span class="fu"><a href="https://tlverse.org/sl3/reference/make_learner_stack.html">make_learner_stack</a></span>(<span class="no">Lrnr_mean</span>,
                            <span class="no">Lrnr_glm</span>,
                            <span class="no">Lrnr_ranger</span>)

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_t4</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">time_varying</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">d</span>,
            <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">10</span>)
)
<span class="co">#&gt;      user  system  elapsed </span>
<span class="co">#&gt;  1371.914  34.843  634.613 </span>

<span class="fu"><a href="https://rdrr.io/pkg/future/man/plan.html">plan</a></span>(<span class="no">multiprocess</span>)

<span class="fu"><a href="https://rdrr.io/r/base/system.time.html">system.time</a></span>(
  <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">sim_t4</span>, <span class="no">a</span>, <span class="st">"Y"</span>, <span class="no">time_varying</span>, <span class="kw">k</span> <span class="kw">=</span> <span class="fl">1</span>, <span class="kw">shift</span> <span class="kw">=</span> <span class="no">d</span>,
            <span class="kw">learners_outcome</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">learners_trt</span> <span class="kw">=</span> <span class="no">lrnrs</span>, <span class="kw">folds</span> <span class="kw">=</span> <span class="fl">10</span>)
)
<span class="co">#&gt;   user  system elapsed </span>
<span class="co">#&gt;  2.353   0.301 194.322 </span></pre></body></html></div>
<p>We recommend consulting the <code>future</code> <a href="https://cran.r-project.org/web/packages/future/future.pdf">documentation</a> for more information.</p>
</div>
<div id="progress-bars-with-progressr" class="section level3">
<h3 class="hasAnchor">
<a href="#progress-bars-with-progressr" class="anchor"></a>Progress bars with progressr</h3>
<p>In the presence of long computation time, a lack of user feedback can become very frustrating. To address this, <code>lmtp</code> supports the use of progress bars during computation through the <a href="https://cran.r-project.org/web/packages/progressr/index.html"><code>progressr</code></a> package.</p>
<div class="sourceCode" id="cb17"><html><body><pre class="r"><span class="fu"><a href="https://rdrr.io/r/base/library.html">library</a></span>(<span class="no">progressr</span>)

<span class="fu"><a href="https://rdrr.io/pkg/progressr/man/with_progress.html">with_progress</a></span>({
  <span class="no">fit</span> <span class="kw">&lt;-</span> <span class="fu"><a href="../reference/lmtp_tmle.html">lmtp_tmle</a></span>(<span class="no">...</span>)
})</pre></body></html></div>
<p>We recommend consulting the <code>progressr</code> <a href="https://cran.r-project.org/web/packages/progressr/progressr.pdf">documentation</a> for more information.</p>
</div>
</div>
<div id="references" class="section level2">
<h2 class="hasAnchor">
<a href="#references" class="anchor"></a>References</h2>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Nicholas Williams, Iván Díaz.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.9000.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
